#!/usr/bin/with-contenv bashio

bashio::log.info "Starting socat process ..."
while true; do
    # Start socat process. This will terminate when when pipe is terminated
    if [[ -z "$SOCAT_LOGFILE" ]]; then
        exec socat $SOCAT_OPTIONS $SOCAT_MASTER $SOCAT_SLAVE
    else
        exec socat $SOCAT_OPTIONS $SOCAT_MASTER $SOCAT_SLAVE > $SOCAT_LOGFILE 2>&1
    fi
    # Do a sleep after the socat has terminated unexpectedly.
    bashio::log.warning "Socat process terminated, restarting after $SOCAT_RESTDELAY sec"
    exec sleep $SOCAT_RESTDELAY
done

